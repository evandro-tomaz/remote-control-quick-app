{"name":"TV Sony teste ok","type":"com.fibaro.genericDevice","apiVersion":"1.1","initialProperties":{"viewLayout":{"$jason":{"body":{"header":{"style":{"height":"100"},"title":"quickApp_device_77"},"sections":{"items":[{"components":[{"components":[{"name":"buttonOn","style":{"weight":"0.50"},"text":"ON","type":"button"},{"name":"buttonOff","style":{"weight":"0.50"},"text":"OFF","type":"button"}],"style":{"weight":"1.2"},"type":"horizontal"},{"style":{"weight":"0.5"},"type":"space"}],"style":{"weight":"1.2"},"type":"vertical"},{"components":[{"components":[{"name":"buttonCh-","style":{"weight":"0.33"},"text":"Chanel -","type":"button"},{"name":"button3_2","style":{"weight":"0.33"},"text":"imput","type":"button"},{"name":"buttonCh+","style":{"weight":"0.33"},"text":"Chanel +","type":"button"}],"style":{"weight":"1.2"},"type":"horizontal"},{"style":{"weight":"0.5"},"type":"space"}],"style":{"weight":"1.2"},"type":"vertical"}]}},"head":{"title":"quickApp_device_77"}}},"uiCallbacks":[{"callback":"uibuttonOnOnReleased","eventType":"onReleased","name":"buttonOn"},{"callback":"uibuttonOffOnReleased","eventType":"onReleased","name":"buttonOff"},{"callback":"uibuttonchRelease","eventType":"onReleased","name":"buttonCh-"},{"callback":"uibuttoninputReleased","eventType":"onReleased","name":"button3_2"},{"callback":"uibuttonchRelease","eventType":"onReleased","name":"buttonCh+"}],"mainFunction":"\nfunction QuickApp:send(dataToSend, waitForResponse)\n    self.sock:close()\n    \n    self:connect(function()     \n        local dataConverted = self:parseData(dataToSend) -- replace string starting with '0x' to hex value\n        self.sock:write(dataConverted, {\n            success = function()\n                if waitForResponse then\n                    self:waitForResponseFunction()\n                else\n                    self.sock:close()\n                end\n            end,\n            error = function(err)\n                self.sock:close()\n            end\n        })\n    end)\nend\n\nfunction QuickApp:parseData(str)\n    while true do \n        if string.find(str, '0x') then\n            i,j = string.find(str, '0x')\n            str = string.sub(str, 1, i - 1) .. self:fromhex(string.sub(str, i + 2, j +2)) .. string.sub(str, j + 3)\n        else\n            return str\n        end\n    end\nend\n\nfunction QuickApp:fromhex(str)\n    return (str:gsub('..', function(cc)\n        return string.char(tonumber(cc, 16))\n    end))\nend\n\nfunction QuickApp:waitForResponseFunction()\n    self.sock:read({\n        success = function(data)\n            self:debug(\"response data:\", data)\n            self.sock:close()\n        end,\n        error = function()\n            self:debug(\"response error\")\n            self.sock:close()\n        end\n    })\nend\n\nfunction QuickApp:connect(successCallback)\n    print(\"connecting:\", self.ip, self.port)\n    self.sock:connect(self.ip, self.port, {\n        success = function()\n            self:debug(\"connected\")\n            successCallback()\n        end,\n        error = function(err)\n            self.sock:close()\n            self:debug(\"connection error\")\n        end,\n    })\nend \n\nfunction QuickApp:onInit()\n    self:debug(\"onInit\")\n    self.ip = self:getVariable(\"ip\")\n    self.port = tonumber(self:getVariable(\"port\"))\n    self.sock = net.TCPSocket()\nend\n\n\nfunction QuickApp:uibuttonOnOnReleased(event)\nself:send(\"38000,1,1,93,21,47,21,24,21,48,21,24,21,48,21,24,21,24,21,48,21,24,21,24,21,24,21,24,972,94,21,48,21,24,21,48,20,25,21,47,21,25,20,25,21,47,21,24,21,25,20,25,21,24,971,94,21,48,20,25,21,47,21,24,21,47,21,24,21,24,21,46,22,24,21,24,21,24,21,25,971,92,22,47,21,24,21,47,21,24,21,47,21,24,21,24,21,48,21,24,21,24,21,24,21,24,971,94,20,47,21,24,21,47,21,24,21,48,21,24,21,24,21,48,21,24,21,24,21,24,21,240x0d0x0a\",true)\nend\n\nfunction QuickApp:uibuttonOffOnReleased(event)\nself:send(\"38000,1,1,93,21,47,21,24,21,48,21,24,21,48,21,24,21,24,21,48,21,24,21,24,21,24,21,24,972,94,21,48,21,24,21,48,20,25,21,47,21,25,20,25,21,47,21,24,21,25,20,25,21,24,971,94,21,48,20,25,21,47,21,24,21,47,21,24,21,24,21,46,22,24,21,24,21,24,21,25,971,92,22,47,21,24,21,47,21,24,21,47,21,24,21,24,21,48,21,24,21,24,21,24,21,24,971,94,20,47,21,24,21,47,21,24,21,48,21,24,21,24,21,48,21,24,21,24,21,24,21,240x0d0x0a\",true)\nend\n\nfunction QuickApp:uibuttonchRelease(event)\nself:send(\"38000,1,1,92,22,23,22,23,22,23,22,23,22,46,22,23,22,23,22,46,22,23,22,23,22,23,22,23,1019,92,22,23,22,23,22,23,22,23,22,46,22,23,22,23,22,46,22,23,22,23,22,23,22,23,1018,93,22,23,22,23,22,23,22,23,22,46,22,23,22,23,22,46,22,23,22,23,22,23,22,23,1018,93,22,23,22,23,22,23,22,23,22,46,22,23,22,23,22,46,22,23,22,23,22,25,20,23,1018,93,22,23,22,23,22,23,22,23,22,46,22,23,22,23,22,46,22,23,22,23,22,23,22,20x0d0x0d\",true)\nend\n\n\n\n\n\n\n","quickAppVariables":[{"name":"ip","value":"192.168.15.33"},{"name":"port","value":"9999"}],"typeTemplateInitialized":true}}